// (c)2012 Gary Johnson

var RAD=Math.PI/180.0;var PI=Math.PI;var TWOPI=Math.PI*2;var ONEOPI=1.0/Math.PI;var PIO2=Math.PI/2;var PIO4=Math.PI/4;var PIO8=Math.PI/8;var PIO16=Math.PI/16;var PIO32=Math.PI/32;var Rnd=Math.random;var Sin=Math.sin;var Cos=Math.cos;var Sqrt=Math.sqrt;var Floor=Math.floor;var Atan2=Math.atan2;var Ceil=Math.ceil;function randomInt(low,high)
{return~~(Rnd()*(high-low+1)+low);}
function weightedRandom(weight)
{var input=Rnd();if(input<0.5)return 1-Math.pow(1-input,weight!==undefined?weight:2)/2;return 0.5+Math.pow((input-0.5)*2,weight!==undefined?weight:2)/2;}
function calcNormalVector(x1,y1,z1,x2,y2,z2)
{return new Vector3D((y1*z2)-(z1*y2),-((z2*x1)-(x2*z1)),(x1*y2)-(y1*x2)).norm();}
function extend(subc,superc,overrides)
{var F=function(){},i;F.prototype=superc.prototype;subc.prototype=new F();subc.prototype.constructor=subc;subc.superclass=superc.prototype;if(superc.prototype.constructor==Object.prototype.constructor)
{superc.prototype.constructor=superc;}
if(overrides)
{for(i in overrides)
{if(overrides.hasOwnProperty(i))
{subc.prototype[i]=overrides[i];}}}}
function isArray(obj)
{return(obj.constructor.toString().indexOf("Array")!==-1);}
(function()
{Vector=function(x,y)
{this.x=x;this.y=y;return this;};Vector.prototype={x:0,y:0,clone:function()
{return new Vector(this.x,this.y);},set:function(v)
{this.x=v.x;this.y=v.y;return this;},add:function(v)
{this.x+=v.x;this.y+=v.y;return this;},nadd:function(v)
{return new Vector(this.x+v.x,this.y+v.y);},sub:function(v)
{this.x-=v.x;this.y-=v.y;return this;},nsub:function(v)
{return new Vector(this.x-v.x,this.y-v.y);},dot:function(v)
{return this.x*v.x+this.y*v.y;},length:function()
{return Sqrt(this.x*this.x+this.y*this.y);},distance:function(v)
{var xx=this.x-v.x;var yy=this.y-v.y;return Sqrt(xx*xx+yy*yy);},theta:function()
{return Atan2(this.y,this.x);},thetaTo:function(vec)
{var v=this.clone().norm();var w=vec.clone().norm();return Math.acos(v.dot(w));},thetaTo2:function(vec)
{return Atan2(vec.y,vec.x)-Atan2(this.y,this.x);},norm:function()
{var len=this.length();this.x/=len;this.y/=len;return this;},nnorm:function()
{var len=this.length();return new Vector(this.x/len,this.y/len);},rotate:function(a)
{var ca=Cos(a);var sa=Sin(a);with(this)
{var rx=x*ca-y*sa;var ry=x*sa+y*ca;x=rx;y=ry;}
return this;},nrotate:function(a)
{var ca=Cos(a),sa=Sin(a);return new Vector(this.x*ca-this.y*sa,this.x*sa+this.y*ca);},invert:function()
{this.x=-this.x;this.y=-this.y;return this;},ninvert:function()
{return new Vector(-this.x,-this.y);},scale:function(s)
{this.x*=s;this.y*=s;return this;},nscale:function(s)
{return new Vector(this.x*s,this.y*s);},scaleTo:function(s)
{var len=s/this.length();this.x*=len;this.y*=len;return this;},nscaleTo:function(s)
{var len=s/this.length();return new Vector(this.x*len,this.y*len)}};})();(function()
{Vector3D=function(x,y,z)
{this.x=x;this.y=y;this.z=z;return this;};Vector3D.prototype={x:0,y:0,z:0,clone:function()
{return new Vector3D(this.x,this.y,this.z);},set:function(v)
{this.x=v.x;this.y=v.y;this.z=v.z;return this;},add:function(v)
{this.x+=v.x;this.y+=v.y;this.z+=v.z;return this;},sub:function(v)
{this.x-=v.x;this.y-=v.y;this.z-=v.z;return this;},dot:function(v)
{return this.x*v.x+this.y*v.y+this.z*v.z;},cross:function(v)
{return new Vector3D(this.y*v.z-this.z*v.y,this.z*v.x-this.x*v.z,this.x*v.y-this.y*v.x);},length:function()
{return Sqrt(this.x*this.x+this.y*this.y+this.z*this.z);},distance:function(v)
{var xx=this.x-v.x;var yy=this.y-v.y;var zz=this.z-v.z;return Sqrt(xx*xx+yy*yy+zz*zz);},thetaTo:function(v)
{var x=this.y*v.z-this.z*v.y,y=this.z*v.x-this.x*v.z,z=this.x*v.y-this.y*v.x;return Atan2(Sqrt(x*x+y*y+z*z),this.dot(v));},thetaTo2:function(v)
{return Math.acos(this.dot(v)/(Sqrt(this.x*this.x+this.y*this.y+this.z*this.z)*Sqrt(v.x*v.x+v.y*v.y+v.z*v.z)));},norm:function()
{var len=this.length();this.x/=len;this.y/=len;this.z/=len;return this;},scale:function(s)
{this.x*=s;this.y*=s;this.z*=s;return this;}};})();(function()
{Preloader=function()
{this.images=new Array();return this;};Preloader.prototype={images:null,callback:null,counter:0,addImage:function addImage(img,url)
{var me=this;img.url=url;img.onload=function()
{me.counter++;if(me.counter===me.images.length)
{me.callback.call(me);}};this.images.push(img);},onLoadCallback:function onLoadCallback(fn)
{this.counter=0;this.callback=fn;for(var i=0,j=this.images.length;i<j;i++)
{this.images[i].src=this.images[i].url;}}};})();